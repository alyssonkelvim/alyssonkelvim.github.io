<html>

<head>
    <script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.1.0/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.0.1/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-physics-system/v3.1.2/dist/aframe-physics-system.min.js"></script>
    <script src="https://unpkg.com/aframe-physics-extras@0.1.2/dist/aframe-physics-extras.min.js"></script>

</head>

<body>

    <script>
        //variaveis de controle
        var scoreVal;
        var velocidade;
        var valendo;
        var telaGameOver;
        var pontuou;
        //elementos
        var dinossauro;
        var score;
        var cacto;
        AFRAME.registerComponent('dinossauro', {
            init: function() {
                dinossauro = this.el;
                scoreVal = 0;
                velocidade = 0;
                valendo = false;
                telaGameOver = true;
                pontuou = false;
                dinossauro.addEventListener("collisions", (e) => {
                    if (valendo) {
                        console.log("blA");
                        valendo = false;
                        telaGameOver = true;
                        perdeu.setAttribute("visible", "true");
                        //alert("Voce perdeu ! Clique na tela para começar novamente ;) ");
                    }
                });
            },
            tick: function() {
                dinossauro.getAttribute("position").y += velocidade;
                score.getAttribute("position").y += velocidade;
                perdeu.getAttribute("position").y += velocidade;
                if (valendo) {
                    if (!pontuou) {
                        pontuou = true;
                        scoreVal++;
                        score.setAttribute("value", "Score: " + scoreVal);
                    }
                }
                if ((!valendo && telaGameOver) || valendo) {
                    velocidade = 0;
                    console.log("blA");
                    valendo = false;
                    telaGameOver = true;
                    perdeu.setAttribute("visible", "true");

                }
            }
        });

    </script>

    <a-scene>

        <a-text value="Score: 0" width="20" id="score" rotation="0 -90 0" color="black" position="-9 8.5 -14.5" rotation="0 0 0"></a-text>
        <a-text value="Voce Perdeu" width="1.3" id="perdeu" rotation="0 -90 0" color="black" position="-13.9 5 -6.17" rotation="0 0 0" visible="false"></a-text>


        <a-entity environment="preset: yavapai; groundColor: #4b803e ; groundColor2: #2a4a17;
        skyColor: #e0ba31; ground: flat; horizonColor: #fab587"></a-entity>

        <a-asset-item id="dinossauro" position="5 0 0" response-type="arraybuffer" src="scene.glb" static-body physics-collider="ignoreSleep: true"></a-asset-item>
        <a-entity gltf-model="#dinossauro" static-body physics-collider="ignoreSleep: true" scale="0.005 0.005 0.005" animation-mixer="clip:Armature|run_cycle" animation="property: position; to: 0 0 -98; dur: 40000; easing: linear" animation-mixer="clip:Armature|run_cycle" wasd-controls="property: acceleration; acceleration: 4000; fly:true; wsAxis: y; wsInverted: true"></a-entity>

        <a-entity camera look-controls position="0 2 3" animation="property: position; to: 0 2 -94; dur: 40000; easing: linear"></a-entity>

        <a-entity gltf-model="arco/scene.gltf" scale="0.1 0.1 0.1" position="0 0 -98" visible=""></a-entity>
        <a-entity gltf-model="arco" scale="0.15 0.15 0.15"></a-entity>


        <a-entity gltf-model="cacto/scene.glb" scale="0.1 0.1 0.1" position="0 0 -10" visible="" static-body physics-collider="ignoreSleep: true"></a-entity>
        <a-entity gltf-model="#cacto" scale="0.15 0.15 0.15"></a-entity>
        <a-entity gltf-model="cacto/scene.glb" scale="0.1 0.1 0.1" position="1.2 0 -10" visible="" static-body physics-collider="ignoreSleep: true"></a-entity>
        <a-entity gltf-model="#cacto" scale="0.15 0.15 0.15"></a-entity>

        <a-entity gltf-model="cacto/scene.glb" scale="0.1 0.1 0.1" position="0 0 -20" visible="" static-body physics-collider="ignoreSleep: true"></a-entity>
        <a-entity gltf-model="#cacto" scale="0.15 0.15 0.15"></a-entity>
        <a-entity gltf-model="cacto/scene.glb" scale="0.1 0.1 0.1" position="-1.2 0 -20" visible="" static-body physics-collider="ignoreSleep: true"></a-entity>
        <a-entity gltf-model="#cacto" scale="0.15 0.15 0.15"></a-entity>

        <a-entity gltf-model="cacto/scene.glb" scale="0.1 0.1 0.1" position="0 0 -30" visible="" static-body physics-collider="ignoreSleep: true"></a-entity>
        <a-entity gltf-model="#cacto" scale="0.15 0.15 0.15"></a-entity>

        <a-entity gltf-model="cacto/scene.glb" scale="0.1 0.1 0.1" position="0 0 -40" visible="" static-body physics-collider="ignoreSleep: true"></a-entity>
        <a-entity gltf-model="#cacto" scale="0.15 0.15 0.15"></a-entity>
        <a-entity gltf-model="cacto/scene.glb" scale="0.1 0.1 0.1" position="-1.2 0 -40" visible="" static-body physics-collider="ignoreSleep: true"></a-entity>
        <a-entity gltf-model="#cacto" scale="0.15 0.15 0.15"></a-entity>

        <a-entity gltf-model="cacto/scene.glb" scale="0.1 0.1 0.1" position="0 0 -50" visible="" static-body physics-collider="ignoreSleep: true"></a-entity>
        <a-entity gltf-model="#cacto" scale="0.15 0.15 0.15"></a-entity>
        <a-entity gltf-model="cacto/scene.glb" scale="0.1 0.1 0.1" position="1.2 0 -50" visible="" static-body physics-collider="ignoreSleep: true"></a-entity>
        <a-entity gltf-model="#cacto" scale="0.15 0.15 0.15"></a-entity>

        <a-entity gltf-model="cacto/scene.glb" scale="0.1 0.1 0.1" position="0 0 -60" visible="" static-body physics-collider="ignoreSleep: true"></a-entity>
        <a-entity gltf-model="#cacto" scale="0.15 0.15 0.15"></a-entity>
        <a-entity gltf-model="cacto/scene.glb" scale="0.1 0.1 0.1" position="1.2 0 -60" visible="" static-body physics-collider="ignoreSleep: true"></a-entity>
        <a-entity gltf-model="#cacto" scale="0.15 0.15 0.15"></a-entity>

        <a-entity gltf-model="cacto/scene.glb" scale="0.1 0.1 0.1" position="0 0 -70" visible="" static-body physics-collider="ignoreSleep: true"></a-entity>
        <a-entity gltf-model="#cacto" scale="0.15 0.15 0.15"></a-entity>
        <a-entity gltf-model="cacto/scene.glb" scale="0.1 0.1 0.1" position="-1.2 0 -70" visible="" static-body physics-collider="ignoreSleep: true"></a-entity>
        <a-entity gltf-model="#cacto" scale="0.15 0.15 0.15"></a-entity>

        <a-entity gltf-model="cacto/scene.glb" scale="0.1 0.1 0.1" position="-1.2 0 -80" visible="" static-body physics-collider="ignoreSleep: true"></a-entity>
        <a-entity gltf-model="#cacto" scale="0.15 0.15 0.15"></a-entity>
        <a-entity gltf-model="cacto/scene.glb" scale="0.1 0.1 0.1" position="1.2 0 -80" visible="" static-body physics-collider="ignoreSleep: true"></a-entity>
        <a-entity gltf-model="#cacto" scale="0.15 0.15 0.15"></a-entity>

        <a-entity gltf-model="cacto/scene.glb" scale="0.1 0.1 0.1" position="0 0 -85" visible="" static-body physics-collider="ignoreSleep: true"></a-entity>
        <a-entity gltf-model="#cacto" scale="0.15 0.15 0.15"></a-entity>

        <a-entity gltf-model="cacto/scene.glb" scale="0.1 0.1 0.1" position="-1.2 0 -90" visible="" static-body physics-collider="ignoreSleep: true"></a-entity>
        <a-entity gltf-model="#cacto" scale="0.15 0.15 0.15"></a-entity>
        <a-entity gltf-model="cacto/scene.glb" scale="0.1 0.1 0.1" position="1.2 0 -90" visible="" static-body physics-collider="ignoreSleep: true"></a-entity>
        <a-entity gltf-model="#cacto" scale="0.15 0.15 0.15"></a-entity>

        <a-entity gltf-model="cacto/scene.glb" scale="0.1 0.1 0.1" position="0 0 -95" visible="" static-body physics-collider="ignoreSleep: true"></a-entity>
        <a-entity gltf-model="#cacto" scale="0.15 0.15 0.15"></a-entity>
    </a-scene>

    <script>
        score = document.getElementById("score");
        perdeu = document.getElementById("perdeu");
        camera = document.getElementById("camera");

        function atualizaCena() {
            if (valendo) {
                definePosicao();
            }
            pontuou = false;
        }

        function iniciar() {
            pontuou = false;
            scoreVal = 0;
            dinossauro.getAttribute("position").x = 5;
            score.getAttribute("position").y = 8.5;
            score.setAttribute("value", "Score: " + scoreVal);
            perdeu.getAttribute("position").y = 5;
            perdeu.setAttribute("visible", "false");
            velocidade = 0;
        }

        function click() {
            if (!valendo && telaGameOver) { //reniciar
                definePosicao();
                iniciar()
            } else if (!valendo && !telaGameOver) {
                valendo = true;
                iniciar();
                atualizaCena();
            }
        }
        $(document).ready(function() {
            window.onloadend = window.alert("Clique em 'Ok' para começar o jogo !");
        });
        document.addEventListener('click', click);
        //document.getElementById("chao").addEventListener('animationcomplete', atualizaCena);
        definePosicao();

    </script>

</body>

</html>
